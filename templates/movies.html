{% extends 'base.html' %}
{% load static %}

{% block content %}

    <!-- Header Start -->
    <div class="jumbotron jumbotron-fluid page-header position-relative overlay-bottom" style="margin-bottom: 90px;">
        <div class="container text-center py-5">
            <h1 class="text-white display-1">Movies</h1>
            <div class="d-inline-flex text-white mb-5">
                <p class="m-0 text-uppercase"><a class="text-white" href="">Home</a></p>
                <i class="fa fa-angle-double-right pt-1 px-3"></i>
                <p class="m-0 text-uppercase">Movies</p>
            </div>
        </div>
    </div>
    <!-- Header End -->

    <!-- Movies Start -->
    <div class="container-fluid py-5">
        <div class="container py-5">
            <div class="row mx-0 justify-content-center">
                <div class="col-lg-8">
                    <div class="section-title text-center position-relative mb-5">
                        <h6 class="d-inline-block position-relative text-secondary text-uppercase pb-2">Our Movies</h6>
                        <h1 class="display-4">Checkout New Releases</h1>
                    </div>
                </div>
            </div>
            
            <!-- Movies Container -->
            <div id="movies-container" class="row">
                {% for movie in movies %}
                <div class="col-lg-4 col-md-6 pb-4 movie-item" data-movie-id="{{ movie.id }}">
                    <a class="courses-list-item position-relative d-block overflow-hidden mb-2" href="">
                        <center>
                            <img class="img-fluid" 
                            src="{{ movie.img.url }}" 
                            alt="{{ movie.title }}"
                            onerror="this.src='{% static 'img/placeholder-movie.jpg' %}'"
                            style="height: 300px; object-fit: cover;">
                        </center>
                        
                            <div class="courses-text">
                            <h4 class="text-center text-white px-3">{{ movie.name }}</h4>
                            
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>

            <!-- Pagination Controls -->
            <div class="col-12">
                <nav aria-label="Page navigation">
                    <ul id="pagination-controls" class="pagination pagination-lg justify-content-center mb-0">
                        <!-- Pagination will be generated by JavaScript -->
                    </ul>
                </nav>
            </div>
        </div>
    </div>
    <!-- Movies End -->

    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-primary rounded-0 btn-lg-square back-to-top"><i class="fa fa-angle-double-up"></i></a>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    class MoviePaginator {
        constructor() {
            this.moviesContainer = document.getElementById('movies-container');
            this.paginationControls = document.getElementById('pagination-controls');
            this.movieItems = document.querySelectorAll('.movie-item');
            this.currentPage = 1;
            this.moviesPerPage = 9;
            this.totalPages = Math.ceil(this.movieItems.length / this.moviesPerPage);
            
            this.init();
        }
        
        init() {
            this.showPage(1);
            this.setupPagination();
        }
        
        showPage(page) {
            this.currentPage = page;
            const startIndex = (page - 1) * this.moviesPerPage;
            const endIndex = startIndex + this.moviesPerPage;
            
            // Hide all movies first
            this.movieItems.forEach((item, index) => {
                if (index >= startIndex && index < endIndex) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
            
            this.setupPagination();
        }
        
        setupPagination() {
            if (this.movieItems.length <= this.moviesPerPage) {
                this.paginationControls.style.display = 'none';
                return;
            }
            
            this.paginationControls.style.display = 'flex';
            let paginationHTML = '';
            
            // Previous button
            if (this.currentPage === 1) {
                paginationHTML += `
                    <li class="page-item disabled">
                        <a class="page-link rounded-0" href="#" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                            <span class="sr-only">Previous</span>
                        </a>
                    </li>
                `;
            } else {
                paginationHTML += `
                    <li class="page-item">
                        <a class="page-link rounded-0" href="#" onclick="paginator.previousPage()" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                            <span class="sr-only">Previous</span>
                        </a>
                    </li>
                `;
            }
            
            // Page numbers - show max 5 pages
            const maxVisiblePages = 5;
            let startPage = Math.max(1, this.currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(this.totalPages, startPage + maxVisiblePages - 1);
            
            // Adjust start page if we're near the end
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            // First page and ellipsis
            if (startPage > 1) {
                paginationHTML += `
                    <li class="page-item"><a class="page-link" href="#" onclick="paginator.goToPage(1)">1</a></li>
                    ${startPage > 2 ? '<li class="page-item disabled"><span class="page-link">...</span></li>' : ''}
                `;
            }
            
            // Page numbers
            for (let i = startPage; i <= endPage; i++) {
                if (i === this.currentPage) {
                    paginationHTML += `
                        <li class="page-item active"><a class="page-link" href="#">${i}</a></li>
                    `;
                } else {
                    paginationHTML += `
                        <li class="page-item"><a class="page-link" href="#" onclick="paginator.goToPage(${i})">${i}</a></li>
                    `;
                }
            }
            
            // Last page and ellipsis
            if (endPage < this.totalPages) {
                paginationHTML += `
                    ${endPage < this.totalPages - 1 ? '<li class="page-item disabled"><span class="page-link">...</span></li>' : ''}
                    <li class="page-item"><a class="page-link" href="#" onclick="paginator.goToPage(${this.totalPages})">${this.totalPages}</a></li>
                `;
            }
            
            // Next button
            if (this.currentPage === this.totalPages) {
                paginationHTML += `
                    <li class="page-item disabled">
                        <a class="page-link rounded-0" href="#" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                            <span class="sr-only">Next</span>
                        </a>
                    </li>
                `;
            } else {
                paginationHTML += `
                    <li class="page-item">
                        <a class="page-link rounded-0" href="#" onclick="paginator.nextPage()" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                            <span class="sr-only">Next</span>
                        </a>
                    </li>
                `;
            }
            
            this.paginationControls.innerHTML = paginationHTML;
        }
        
        goToPage(page) {
            event.preventDefault();
            this.showPage(page);
            // Scroll to top of movies section
            this.moviesContainer.scrollIntoView({ behavior: 'smooth' });
        }
        
        nextPage() {
            event.preventDefault();
            if (this.currentPage < this.totalPages) {
                this.showPage(this.currentPage + 1);
                this.moviesContainer.scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        previousPage() {
            event.preventDefault();
            if (this.currentPage > 1) {
                this.showPage(this.currentPage - 1);
                this.moviesContainer.scrollIntoView({ behavior: 'smooth' });
            }
        }
    }

    // Initialize the paginator
    window.paginator = new MoviePaginator();
});
</script>
{% endblock %}